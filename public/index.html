<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Daddy Has 100 Pedals</title>
  <link rel="stylesheet" href="css/main.css" />
</head>

<body>
  <main>
    <p class="imprint"><strong>Shy Boyz Books</strong> Presents</p>
    <h1>My Daddy Has 100 Pedals</h1>
    <p class="site-description">Billy Cardigan, host of YouTubeâ€™s Effects & Pedals Arena Corner takes young readers on a
      vivid journey through the grown-up hobby of collecting guitar pedals and gear. </p>
    <div class="product">
      <div class="book-container">
        <div class="book"><img alt="My Daddy has 100 Pedals" src="img/cover.jpg"></div>
      </div>
      <div>
        <h2>My Daddy Has 100 Pedals</h2>
        <p class="description"><strong class="price">$15</strong> A book by Billy Cardigan</p>
        <form action="/.netlify/functions/create-checkout" method="post">
          <div class="input">
            <label for="quantity">Quantity</label>
            <select name="quantity" id="quantity">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </div>
          <div class="input">
            <label for="shipping">Shipping</label>
            <select name="shipping" id="shipping">
              <option value="US">US - $3</option>
              <option value="CA">Canada - $10</option>
              <option value="">Global - $15</option>
            </select>
          </div>
          <button type="submit">Buy Now</button>
        </form>
      </div>
    </div>
  </main>

  <footer>
    <p>
    </p>
  </footer>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
    function format(amount, currency) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency,
      }).format((amount / 100).toFixed(2));
    }

    async function handleSubmit(event) {
      event.preventDefault();
      document
        .querySelectorAll('button')
        .forEach((button) => (button.disabled = true));


      const form = new FormData(event.target);
      const data = {
        quantity: Number(form.get('quantity')),
        shippingCountry: form.get('shipping'),
      };
      const response = await fetch('/.netlify/functions/create-checkout', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      }).then((res) => res.json());

      const stripe = Stripe(response.publishableKey);
      const { error } = await stripe.redirectToCheckout({
        sessionId: response.sessionId,
      });

      if (error) {
        document
          .querySelectorAll('button')
          .forEach((button) => (button.disabled = false));
        console.error(error);
      }
    }

    function init() {
      const form = document.querySelector('form');
      form.addEventListener('submit', handleSubmit);
    }

    init();
  </script>
</body>

</html>